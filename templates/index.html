<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BERT-Powered Resume–Job Description Matcher</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg1: #f5f7fa;
      --bg2: #c3cfe2;
      --card: #ffffff;
      --primary: #228be6;
      --primary-600: #1971c2;
      --muted: #495057;
      --border: #dee2e6;
      --border-strong: #ced4da;
      --good: #40c057;
      --warn: #fd7e14;
      --info: #ffd43b;
      --shadow-strong: 0 15px 40px rgba(0, 0, 0, 0.15);
      --shadow: 0 5px 15px rgba(34, 139, 230, 0.3);
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #1f2937;
    }
    .container {
      width: 90%;
      max-width: 880px;
      background: var(--card);
      padding: 2.5rem;
      border-radius: 20px;
      box-shadow: var(--shadow-strong);
      margin: 2rem auto;
    }
    header h1 {
      color: #2c3e50;
      margin-bottom: 0.5rem;
      font-size: 2.2rem;
      text-align: center;
      font-weight: 800;
      letter-spacing: -0.5px;
    }
    header p.sub {
      text-align: center;
      color: #6c757d;
      margin-bottom: 1.75rem;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: block;
      width: 100%;
    }
    .file-input-wrapper input[type=file] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      height: 100%;
      width: 100%;
      font-size: 0;
    }
    .file-input-label {
      display: flex;
      padding: 1.75rem;
      background: #f8f9fa;
      border: 2.5px dashed var(--border);
      border-radius: 12px;
      text-align: center;
      color: var(--muted);
      transition: all 0.25s ease;
      align-items: center;
      justify-content: center;
      gap: 10px;
      min-height: 120px;
      user-select: none;
    }
    .file-input-label:hover {
      background: #e9ecef;
      border-color: var(--primary);
      color: var(--primary);
    }
    .file-input-label.dragover {
      background: #e7f5ff;
      border-color: var(--primary);
      color: var(--primary);
    }
    .file-hint {
      font-size: 0.95rem;
      color: #6c757d;
      margin-top: -0.25rem;
    }

    .actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    button {
      padding: 1rem 1.25rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.05rem;
      font-weight: 700;
      transition: all 0.25s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    button:hover {
      background: var(--primary-600);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }
    button:active { transform: translateY(0); }
    .btn-secondary {
      background: #f1f3f5;
      color: #212529;
    }
    .btn-secondary:hover {
      background: #e9ecef;
      box-shadow: none;
    }

    .status {
      margin-top: 1.25rem;
      padding: 1rem 1.25rem;
      background: #fff9db;
      color: #664d03;
      border: 1px solid #ffe066;
      border-radius: 12px;
      font-size: 0.98rem;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.75rem;
      animation: fadeIn 0.4s ease-in;
    }
    .status strong { color: #5c940d; }

    .results {
      margin-top: 1.25rem;
      display: grid;
      gap: 0.75rem;
    }
    .flash, .advice {
      padding: 1.1rem 1.25rem;
      border-radius: 12px;
      animation: fadeIn 0.4s ease-in;
    }
    .flash {
      background: #e6fcf5;
      color: #0b7285;
      border: 1px solid #96f2d7;
    }
    .advice {
      background: #fff4e6;
      color: #d9480f;
      border: 1px solid #ffc078;
      white-space: pre-wrap;
    }

    .footer-note {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #6c757d;
      text-align: center;
    }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      backdrop-filter: saturate(1.2) blur(2px);
    }
    .loading-overlay.active { display: flex; }
    .spinner {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: 6px solid #d0ebff;
      border-top-color: var(--primary);
      animation: spin 0.9s linear infinite;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .container { width: 95%; padding: 1.5rem; }
      header h1 { font-size: 1.85rem; }
      .file-input-label { min-height: 110px; padding: 1.25rem; }
      button { width: 100%; }
      .actions { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loading">
    <div class="spinner" aria-label="Analyzing..."></div>
  </div>

  <main class="container">
    <header>
      <h1>BERT-Powered Resume–Job Description Matcher</h1>
      <p class="sub">Upload a PDF or DOCX resume to analyze similarity with the target job description.</p>
    </header>

    <form action="{{ url_for('index') }}" method="post" enctype="multipart/form-data" id="analyze-form" novalidate>
      <div class="file-input-wrapper" id="drop-zone">
        <input type="file" name="resume" id="resume" accept=".pdf,.docx" required aria-label="Upload resume file (PDF or DOCX)" />
        <label for="resume" class="file-input-label" id="resume-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               aria-hidden="true">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          <span id="label-text">Drop your resume here or click to browse (PDF or DOCX)</span>
        </label>
      </div>
      <p class="file-hint">Allowed types: .pdf, .docx • Max length handled by server • Your file is processed locally on the server.</p>

      <div class="actions">
        <button type="submit" id="submit-btn">Analyze Resume</button>
        <button type="button" class="btn-secondary" id="reset-btn" title="Clear selected file">Reset</button>
      </div>

      {% if uploaded_file %}
        <div class="status" role="status" aria-live="polite">
          <span>✓</span>
          <div>
            <strong>File Uploaded:</strong> {{ uploaded_file }}
          </div>
        </div>
      {% endif %}

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <section class="results" aria-live="polite" aria-atomic="true">
            {% for message in messages %}
              {% if "Match Score" in message %}
                <div class="flash">
                  <p>{{ message }}</p>
                </div>
              {% else %}
                <div class="advice">
                  <p>{{ message | replace('\n', '<br>') | safe }}</p>
                </div>
              {% endif %}
            {% endfor %}
          </section>
        {% endif %}
      {% endwith %}
    </form>

    <p class="footer-note">Tip: Including relevant keywords and clear section headings (Skills, Experience, Summary) can improve your match.</p>
  </main>

  <script>
    (function () {
      const form = document.getElementById('analyze-form');
      const fileInput = document.getElementById('resume');
      const label = document.getElementById('resume-label');
      const labelText = document.getElementById('label-text');
      const dropZone = document.getElementById('drop-zone');
      const loading = document.getElementById('loading');
      const submitBtn = document.getElementById('submit-btn');
      const resetBtn = document.getElementById('reset-btn');

      const validExt = ['pdf', 'docx'];

      function getExt(name) {
        const parts = name.split('.');
        return parts.length > 1 ? parts.pop().toLowerCase() : '';
      }

      function setLabelToFile(name) {
        labelText.textContent = name || 'Drop your resume here or click to browse (PDF or DOCX)';
      }

      function validateFile(file) {
        const ext = getExt(file.name || '');
        return validExt.includes(ext);
      }

      // Update label on file select
      fileInput.addEventListener('change', () => {
        const file = fileInput.files && fileInput.files[0];
        if (!file) { setLabelToFile(''); return; }
        if (!validateFile(file)) {
          alert('Unsupported file format. Please upload a PDF or DOCX file.');
          fileInput.value = '';
          setLabelToFile('');
          return;
        }
        setLabelToFile(file.name);
      });

      // Drag & drop highlight
      ['dragenter', 'dragover'].forEach(evt => {
        dropZone.addEventListener(evt, (e) => {
          e.preventDefault(); e.stopPropagation();
          label.classList.add('dragover');
        });
      });
      ['dragleave', 'drop'].forEach(evt => {
        dropZone.addEventListener(evt, (e) => {
          e.preventDefault(); e.stopPropagation();
          label.classList.remove('dragover');
        });
      });
      dropZone.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        if (!dt || !dt.files || !dt.files.length) return;
        const file = dt.files[0];
        if (!validateFile(file)) {
          alert('Unsupported file format. Please upload a PDF or DOCX file.');
          return;
        }
        // Assign dropped file to input
        fileInput.files = dt.files;
        setLabelToFile(file.name);
      });

      // Submit: show loading overlay
      form.addEventListener('submit', (e) => {
        if (!fileInput.files || !fileInput.files.length) {
          e.preventDefault();
          alert('Please select a resume file first.');
          return;
        }
        const file = fileInput.files[0];
        if (!validateFile(file)) {
          e.preventDefault();
          alert('Unsupported file format. Please upload a PDF or DOCX file.');
          return;
        }
        loading.classList.add('active');
        submitBtn.disabled = true;
      });

      // Reset selection
      resetBtn.addEventListener('click', () => {
        fileInput.value = '';
        setLabelToFile('');
      });
    })();
  </script>
</body>
</html>